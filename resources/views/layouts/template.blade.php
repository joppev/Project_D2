<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="/assets/icons/site.webmanifest">
    <link rel="mask-icon" href="/assets/icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="theme-color" content="#ffffff">
{{--    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">--}}
    <link rel="stylesheet" href="https://r0743641.eu.qlikcloud.com/resources/autogenerated/qlik-styles.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{{ mix('css/app.css') }}">

    <title>Project2D</title>
</head>
<body class="normal_body" >
{{--  Navigation  --}}

@include('shared.navigation')



<main class="container size mt-3">

    @yield('main', 'Page under construction ...')
</main>

{{--  Footer  --}}
@include('shared.footer')
<script type="text/javascript" src="https://r0743641.eu.qlikcloud.com/resources/assets/external/requirejs/require.js"></script>
<script src="{{ mix('js/app.js') }}"></script>
<script type="text/javascript" charset="utf8" src=https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js></script>
<script type="text/javascript" charset="utf8" src=https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js></script>

{{--<script type="text/javascript" src="https://r0743641.eu.qlikcloud.com/resources/assets/external/requirejs/require.js"></script>--}}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js%22%3E"></script>
@auth
    @if(auth()->user()->isAdmin or auth()->user()->isReceptionist or auth()->user()->isChauffeur)
    <script>
    /*
 * Basic responsive mashup template
 * @owner Enter you name here (xxx)
 */
    /*
     *    Fill in host and port for Qlik engine
     */


    connect();

    async function connect() {
        const urlQlikServer = "https://r0743641.eu.qlikcloud.com/";
        const urlLoggedIn = "api/v1/audits";//Use GET request to see if you are authenticated
        const urlLogin = "login";
        const webIntegrationId = 'cK9TyumJP0zKJwLCbjMFdr63KV9Wv0_R';

        //Check to see if logged in
        return await fetch(`${urlQlikServer}${urlLoggedIn}`, {
            credentials: 'include',
            headers: {
                'Qlik-Web-Integration-ID':webIntegrationId
            }
        })
            .then(async function(response)
            {
                //check if user is authenticated; if not, redirect to login page
                if(response.status===401){
                    const url = new URL(`${urlQlikServer}login`);
                    url.searchParams.append('returnto', 'https://projectd2.westeurope.cloudapp.azure.com');
                    url.searchParams.append('qlik-web-integration-id', webIntegrationId);

                    window.location.href = url;
                }
            })
            .catch(function(error)
            {
                console.error(error);
            });
    }

    var config1 = {
        host: "r0743641.eu.qlikcloud.com", //the address of your Qlik Engine Instance
        prefix: "/", //or the virtual proxy to be used. for example "/anonymous/"
        port: 443, //or the port to be used if different from the default port
        isSecure: true, //should be true if connecting over HTTPS
        webIntegrationId: 'cK9TyumJP0zKJwLCbjMFdr63KV9Wv0_R' //only needed in SaaS editions and QSEoK
    };

    require.config( {
        baseUrl: (config1.isSecure ? "https://" : "http://" ) + config1.host + (config1.port ? ":" + config1.port : "") + config1.prefix + "resources",
        webIntegrationId: config1.webIntegrationId
    } );

    require( ["js/qlik"], function ( qlik ) {
        console.log('qlik', qlik);
        qlik.on( "error", function ( error ) {
            $( '#popupText' ).append( error.message + "<br>" );
            $( '#popup' ).fadeIn( 1000 );
        } );
        $( "#closePopup" ).click( function () {
            $( '#popup' ).hide();
        } );


        //opend corona app
        var app = qlik.openApp("a3833f7e-6ba8-4084-be3c-f40e6d52ee04", config1);

        //gemiddelde tijd in het bedrijf
        app.getObject('QV01', 'qdrKKC');
        //map voor chauffeur
        app.getObject('QV02', 'XPRUT');
        //aanwezigheid op gedrijf controleren
        app.getObject('QV03', 'hPpAzna');
        // stok bijhouden van alle afgewerkte producten
        app.getObject('QV04', 'PyBPvw');
        // filter op bedrijf
        app.getObject('QV05', 'RAbGER');
        // filer op kade
        app.getObject('QV06', 'eJfMLwH');
        //gescande nummerplaten
        app.getObject('QV07', 'YXSfypC');


        //clear all functie werkt niet omdat ik met verschillende alternet states heb
        $("#clearAll").click(function() {
            app.clearAll(true);


        });
        //geeft een lijst weer met alle qlik themas die je hebt
        //qlik.getThemeList().then(function(list){ var str = ""; list.forEach(function(value) { str += value.name + '(' + value.id + ")\n"; }); alert(str); });
        //applyd het genoemde thema en past het toe op de webpagina
        qlik.theme.apply('project4.0').then(function(result){
            //alert('theme applied with result: ' + result);
        });
        //laat zien welk thema er op de html pagina gebruikt word
        /*   app.theme.getApplied().then(function(qtheme){
           alert('Current theme background color: ' + qtheme.id);

           });*/
    } );

</script>
        @endif

@endauth
@yield('script_after')
@if(env('APP_DEBUG'))
    <script>
        $('form').attr('novalidate', 'true');
    </script>
@endif

</body>
</html>
